# BoxJS 订阅配置说明

## 订阅地址

```
https://raw.githubusercontent.com/byhooi/Surge/main/boxjs/byhooi.boxjs.json
```

## 功能概览

本订阅包含以下应用：

1. **京东 WSKEY 青龙同步** - 自动获取京东 WSKEY 并同步到青龙面板
2. **京东 Cookie 青龙同步** - 自动获取京东 Cookie 并同步到青龙面板
3. **AI运动跳绳统计参数** - 跳绳数据分析和考核判定
4. **伴生活 Token 管理** - 自动捕获和存储 Token

---

## 一、京东 WSKEY 青龙同步

### 使用步骤

#### 1. 安装 BoxJS 订阅

在 BoxJS 中添加订阅地址（见上方）

#### 2. 配置青龙面板

#### 2.1 创建应用

1. 登录青龙面板
2. 进入 **系统设置** → **应用设置**
3. 点击 **新建应用**
4. 填写应用名称（如：Surge WSKEY 同步）
5. 选择权限：
   - ✅ 环境变量
   - ✅ 查看
   - ✅ 新增
   - ✅ 更新
6. 保存后会获得 `Client ID` 和 `Client Secret`

#### 2.2 在 BoxJS 中配置

打开 BoxJS → **京东 WSKEY 青龙同步** → 填写以下信息：

| 配置项 | 说明 | 示例 |
|--------|------|------|
| 青龙面板地址 | 青龙面板的完整 URL | `http://192.168.1.100:5700` |
| Client ID | 应用的 Client ID | 从青龙面板复制 |
| Client Secret | 应用的 Client Secret | 从青龙面板复制 |
| 自动同步到青龙 | 开启后获取 WSKEY 时自动同步 | 建议开启 |
| 同步间隔 | 自动同步的时间间隔(分钟) | 默认 60 分钟 |

#### 3. 获取 WSKEY

1. 确保 Surge 已安装 `wskey.sgmodule` 模块
2. 在京东 APP 中登录账号
3. 访问京东相关页面触发抓取
4. 在 BoxJS 中查看获取到的 WSKEY 列表

#### 4. 同步到青龙

**方法一：自动同步（推荐）**

开启 **自动同步到青龙** 选项，获取到新的 WSKEY 后会自动同步。

**方法二：手动同步**

1. 打开 BoxJS
2. 进入 **京东 WSKEY 青龙同步**
3. 点击 **同步 WSKEY 到青龙** 按钮

#### 5. 其他功能

**清空 WSKEY 列表**

- 用途：清空本地存储的所有 WSKEY
- 操作：点击 **清空 WSKEY 列表** 按钮
- 说明：清空后不影响青龙面板中已同步的数据

**关于青龙 Token**

- Token 由同步脚本自动管理，有效期 7 天，脚本会在 6.5 天时自动刷新
- 无需手动操作，Token 失效时会自动重新获取

### 青龙面板变量说明

同步到青龙后，环境变量格式：

- **变量名**：`JD_WSCK`
- **变量值**：`pin=用户名; wskey=xxxxx;`
- **备注**：`用户名 - 由 Surge 同步`

### 常见问题

**Q: 同步失败怎么办？**

1. 检查青龙面板地址是否正确（注意端口号）
2. 检查 Client ID 和 Client Secret 是否正确
3. 检查青龙面板应用权限是否包含环境变量的查看、新增、更新
4. 查看 Surge 日志了解详细错误信息

### Q: 如何知道同步成功？

1. 查看 Surge 通知
2. 登录青龙面板，在环境变量中查看 `JD_WSCK` 变量
3. 备注中会显示 "由 Surge 同步" 字样

### Q: WSKEY 会重复添加吗？

不会。脚本会根据 `pt_pin`（用户名）自动判断：
- 如果是新用户，会添加新的环境变量
- 如果用户已存在但 WSKEY 变化，会更新现有变量
- 如果 WSKEY 未变化，会跳过同步

### Q: 支持多账号吗？

支持。可以获取多个京东账号的 WSKEY，每个账号会作为独立的环境变量同步到青龙。

## 注意事项

1. **安全性**：请妥善保管 Client ID 和 Client Secret
2. **网络**：确保运行 Surge 的设备能访问青龙面板地址
3. **频率**：建议同步间隔不要设置太短，避免对青龙面板造成压力
4. **备份**：定期备份青龙面板数据，避免数据丢失

## 文件说明

| 文件 | 说明 |
|------|------|
| `wskey.sgmodule` | Surge 模块，用于获取 WSKEY |
| `wskey.js` | WSKEY 获取脚本 |
| `wskey_ql_sync.js` | 青龙同步脚本（内置自动 Token 管理） |
| `wskey_clear.js` | 清空 WSKEY 列表脚本 |
| `byhooi.boxjs.json` | BoxJS 配置文件 |

## 更新日志

### v1.1.0
- 移除"获取青龙 Token"按钮，Token 完全自动管理
- 简化 BoxJS 配置界面，隐藏技术细节字段
- 优化用户体验，减少不必要的手动操作

### v1.0.0
- 初始版本
- 支持自动/手动同步 WSKEY 到青龙
- 支持多账号管理
- 自动判断新增/更新/跳过

## 致谢

- 参考了 [@Sliverkiss](https://github.com/Sliverkiss) 的青龙同步配置
- 感谢京东脚本开发者们的贡献

## 许可

MIT License

---

## 二、京东 Cookie 青龙同步

### 功能说明

与 WSKEY 同步类似，但获取的是完整的京东 Cookie（包含 `pt_key` 和 `pt_pin`）。

### 配置说明

1. 安装 `jdcookie.sgmodule` 模块
2. 配置方式与 WSKEY 同步完全相同（共享青龙面板配置）
3. 同步到青龙的环境变量名为 `JD_COOKIE`
4. 变量格式：`pt_key=xxx;pt_pin=xxx;`

### 使用场景

- 某些京东脚本需要完整 Cookie 而不是 WSKEY
- Cookie 有效期较短，需要更频繁更新

---

## 三、AI运动跳绳统计参数

### 功能说明

分析跳绳运动数据，自动判定考核结果并记录日志。

### 配置项

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 默认合格次数 | 3 | 满足多少次合格视为通过 |
| 达标跳绳数阈值 | 195 | 一分钟跳绳数达到该值计为合格 |
| 优秀跳绳数阈值 | 200 | 一分钟跳绳数达到该值计为优秀 |
| 日志输出 | - | 自动显示最新一次运行日志（每次覆盖） |

### 判定规则

- 有优秀成绩可减少 1 次合格要求
- 脚本自动分析响应数据并推送通知
- 日志包含：执行时间、考核结果、跳绳数据、视频链接

### 使用方法

1. 安装 `VideoUrl.sgmodule` 模块
2. 在 BoxJS 中调整阈值参数（可选）
3. 访问跳绳记录页面，脚本自动拦截并分析
4. 查看通知或 BoxJS 日志了解结果

---

## 四、伴生活 Token 管理

### 功能说明

自动捕获 HTTP 请求头中的 `token` 字段变化并持久化存储。

### 使用方法

1. 安装 `bsh.sgmodule` 模块
2. 访问伴生活相关页面
3. Token 自动写入 BoxJS 的 `token` 字段
4. 可在 BoxJS 中查看或手动修改
